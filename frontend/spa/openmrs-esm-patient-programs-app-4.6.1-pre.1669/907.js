"use strict";(globalThis.webpackChunk_openmrs_esm_patient_programs_app=globalThis.webpackChunk_openmrs_esm_patient_programs_app||[]).push([[907],{6760:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(272),a=r.n(n),o=r(2609),l=r.n(o)()(a());l.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-programs__programs-form__loading___pVOFs{margin-left:1rem;width:2rem;min-height:2.5rem}.-esm-patient-programs__programs-form__button___eRXFg{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-programs__programs-form__tablet___d5Lkl{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-programs__programs-form__desktop___SSrz2{padding:0rem}.-esm-patient-programs__programs-form__formContainer___D93YE{margin:1rem}.-esm-patient-programs__programs-form__form___aSYHz{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/programs/programs-form.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCrDF,uDACE,gBAAA,CACA,UAAA,CACA,iBAAA,CAGF,sDACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAGF,sDACE,mBAAA,CACA,qBDjBM,CCoBR,uDACE,YAAA,CAGF,6DACE,WAAA,CAGF,oDACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,yBAAA",sourceRoot:""}]),l.locals={loading:"-esm-patient-programs__programs-form__loading___pVOFs",button:"-esm-patient-programs__programs-form__button___eRXFg",tablet:"-esm-patient-programs__programs-form__tablet___d5Lkl",desktop:"-esm-patient-programs__programs-form__desktop___SSrz2",formContainer:"-esm-patient-programs__programs-form__formContainer___D93YE",form:"-esm-patient-programs__programs-form__form___aSYHz"};const i=l},2907:(e,t,r)=>{r.r(t),r.d(t,{default:()=>j});var n=r(268),a=r.n(n),o=r(4924),l=r(3565),i=r.n(l),u=r(9626),s=r(3139),c=r(6772),m=r(7289),d=r(906),p=r(1470),g=r(1354),f=r.n(g),v=r(1583),b=r.n(v),y=r(7378),A=r.n(y),_=r(5993),h=r.n(_),C=r(4154),E=r.n(C),w=r(8141),O=r.n(w),P=r(6760),D={};D.styleTagTransform=O(),D.setAttributes=h(),D.insert=A().bind(null,"head"),D.domAPI=b(),D.insertStyleElement=E(),f()(P.Z,D);const S=P.Z&&P.Z.locals?P.Z.locals:void 0;function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Z(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const j=function(e){var t,r,n,l,g=e.closeWorkspace,f=e.patientUuid,v=e.programEnrollmentId,b=(0,o.useTranslation)().t,y="tablet"===(0,d.useLayoutType)(),A=(0,d.useSession)(),_=(0,d.useLocations)(),h=(0,p.oI)().data,C=(0,p.Bw)(f),E=C.data,w=C.mutateEnrollments,O=v&&E.filter((function(e){return e.uuid==v}))[0],P=O?function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){k(e,t,r[t])}))}return e}({display:O.program.name},O.program):null,D=P?[P]:(0,u.Z)(h,(function(e){return!(0,s.Z)((0,c.Z)(E,"program.uuid"),e.uuid)})),Z=x(a().useState((null==O?void 0:O.dateCompleted)?(0,d.parseDate)(O.dateCompleted):null),2),j=Z[0],T=Z[1],F=x(a().useState((null==O?void 0:O.dateEnrolled)?(0,d.parseDate)(O.dateEnrolled):new Date),2),I=F[0],L=F[1],B=x(a().useState(null!==(r=null==O?void 0:O.program.uuid)&&void 0!==r?r:""),2),N=B[0],Y=B[1],V=x(a().useState(null!==(n=null==O?void 0:O.location.uuid)&&void 0!==n?n:""),2),H=V[0],M=V[1];!H&&(null==A||null===(t=A.sessionLocation)||void 0===t?void 0:t.uuid)&&M(null==A||null===(l=A.sessionLocation)||void 0===l?void 0:l.uuid);var q=a().useCallback((function(e){if(e.preventDefault(),N){var t={patient:f,program:N,dateEnrolled:I?i()(I).format():null,dateCompleted:j?i()(j).format():null,location:H},r=new AbortController,n=O?(0,p.YX)(O.uuid,t,r).subscribe((function(e){200===e.status&&(w(),g(),(0,d.showToast)({critical:!0,kind:"success",description:b("enrollmentUpdatesNowVisible","Changes to the program are now visible in the Programs table"),title:b("enrollmentUpdated","Program enrollment updated")}))}),(function(e){(0,d.createErrorHandler)(),(0,d.showNotification)({title:b("programEnrollmentSaveError","Error saving program enrollment"),kind:"error",critical:!0,description:null==e?void 0:e.message})})):(0,p.df)(t,r).subscribe((function(e){201===e.status&&(w(),g(),(0,d.showToast)({critical:!0,kind:"success",description:b("enrollmentNowVisible","It is now visible in the Programs table"),title:b("enrollmentSaved","Program enrollment saved")}))}),(function(e){(0,d.createErrorHandler)(),(0,d.showNotification)({title:b("programEnrollmentSaveError","Error saving program enrollment"),kind:"error",critical:!0,description:null==e?void 0:e.message})}));return function(){n.unsubscribe()}}}),[N,f,I,j,H,O,w,g,b]),R=a().createElement(m.PhF,{id:"program",invalidText:b("required","Required"),labelText:"",onChange:function(e){return Y(e.target.value)}},N?null:a().createElement(m.QlF,{text:b("chooseProgram","Choose a program"),value:""}),(null==D?void 0:D.length)>0&&D.map((function(e){return a().createElement(m.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)})));return a().createElement(m.l09,{className:S.form,onSubmit:q},a().createElement(m.Kqy,{className:S.formContainer,gap:7},D.length?null:a().createElement(m.K0D,{style:{minWidth:"100%",margin:"0rem",padding:"0rem"},kind:"error",lowContrast:!0,subtitle:b("configurePrograms","Please configure programs to continue."),title:b("noProgramsConfigured","No programs configured")}),a().createElement(m.cwH,{style:{maxWidth:"50%"},legendText:b("programName","Program name")},a().createElement("div",{className:S.selectContainer},y?a().createElement(m.mh4,null,R):R)),a().createElement(m.cwH,{style:{maxWidth:"50%"},legendText:b("dateEnrolled","Date enrolled")},y?a().createElement(m.mh4,null,a().createElement(m.Mtg,{id:"enrollmentDate",datePickerType:"single",dateFormat:"d/m/Y",maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=x(e,1)[0];return L(t)},value:I},a().createElement(m.aj6,{id:"enrollmentDateInput",labelText:""}))):a().createElement(m.Mtg,{id:"enrollmentDate",datePickerType:"single",dateFormat:"d/m/Y",maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=x(e,1)[0];return L(t)},value:I},a().createElement(m.aj6,{id:"enrollmentDateInput",labelText:""}))),a().createElement(m.cwH,{style:{width:"50%"},legendText:b("dateCompleted","Date completed")},y?a().createElement(m.mh4,null,a().createElement(m.Mtg,{id:"completionDate",datePickerType:"single",dateFormat:"d/m/Y",minDate:new Date(I).toISOString(),maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=x(e,1)[0];return T(t)},value:j},a().createElement(m.aj6,{id:"completionDateInput",labelText:""}))):a().createElement(m.Mtg,{id:"completionDate",datePickerType:"single",dateFormat:"d/m/Y",minDate:new Date(I).toISOString(),maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=x(e,1)[0];return T(t)},value:j},a().createElement(m.aj6,{id:"completionDateInput",labelText:""}))),a().createElement(m.cwH,{style:{width:"50%"},legendText:b("enrollmentLocation","Enrollment location")},y?a().createElement(m.mh4,null,a().createElement(m.PhF,{id:"location",invalidText:"Required",labelText:"",onChange:function(e){return M(e.target.value)},value:H},H?null:a().createElement(m.QlF,{text:b("chooseLocation","Choose a location"),value:""}),(null==_?void 0:_.length)>0&&_.map((function(e){return a().createElement(m.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)})))):a().createElement(m.PhF,{id:"location",invalidText:"Required",labelText:"",onChange:function(e){return M(e.target.value)},value:H},H?null:a().createElement(m.QlF,{text:b("chooseLocation","Choose a location"),value:""}),(null==_?void 0:_.length)>0&&_.map((function(e){return a().createElement(m.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)}))))),a().createElement(m.uVA,{className:y?S.tablet:S.desktop},a().createElement(m.zxk,{className:S.button,kind:"secondary",onClick:function(){return g()}},b("cancel","Cancel")),a().createElement(m.zxk,{className:S.button,kind:"primary",disabled:!N,type:"submit"},b("saveAndClose","Save and close"))))}},1470:(e,t,r)=>{r.d(t,{Bw:()=>c,YX:()=>p,b$:()=>g,df:()=>d,oI:()=>m});var n=r(3255),a=r(906),o=r(4221),l=r(9626),i=r(3139),u=r(6772);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){var t,r="/ws/rest/v1/programenrollment?patient=".concat(e,"&v=").concat("custom:(uuid,display,program,dateEnrolled,dateCompleted,location:(uuid,display))"),l=(0,n.ZP)(e?r:null,a.openmrsFetch),i=l.data,u=l.error,s=l.isLoading,c=l.isValidating,m=l.mutate,d=(null==i||null===(t=i.data)||void 0===t?void 0:t.results.length)>0?null==i?void 0:i.data.results.sort((function(e,t){return t.dateEnrolled>e.dateEnrolled?1:-1})):null,p=null==d?void 0:d.filter((function(e){return!e.dateCompleted}));return{data:i?(0,o.Z)(d,(function(e){var t;return null==e||null===(t=e.program)||void 0===t?void 0:t.uuid})):null,isError:u,isLoading:s,isValidating:c,activeEnrollments:p,mutateEnrollments:m}}function m(e){var t,r,o=(0,n.ZP)("/ws/rest/v1/program?v=custom:(uuid,display,allWorkflows,concept:(uuid,display))",a.openmrsFetch),s=o.data,c=o.error,m=o.isLoading,d=null!==(r=null==s||null===(t=s.data)||void 0===t?void 0:t.results)&&void 0!==r?r:null;return{data:d,isError:c,isLoading:m,eligiblePrograms:(0,l.Z)(d,(function(t){return!(0,i.Z)((0,u.Z)(e,"program.uuid"),t.uuid)}))}}function d(e,t){if(!e)return null;var r=e.program,n=e.patient,o=e.dateEnrolled,l=e.dateCompleted,i=e.location;return(0,a.openmrsObservableFetch)("/ws/rest/v1/programenrollment",{method:"POST",headers:{"Content-Type":"application/json"},body:{program:r,patient:n,dateEnrolled:o,dateCompleted:l,location:i},signal:t.signal})}function p(e,t,r){if(!t&&!t.program)return null;t.program;var n=t.dateEnrolled,o=t.dateCompleted,l=t.location;return(0,a.openmrsObservableFetch)("/ws/rest/v1/programenrollment/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:{dateEnrolled:n,dateCompleted:o,location:l},signal:r.signal})}var g=function(e){var t,r,o=(0,a.useConfig)().customUrl,l=c(e),i=l.data,u=l.isError,d=l.isLoading,p=l.isValidating,g=l.activeEnrollments,f=m(i),v=f.data,b=f.eligiblePrograms,y=function(e){var t,r=(0,a.useConfig)().customUrl,o=(0,n.ZP)(r?"".concat(r).concat(e):null,a.openmrsFetch),l=o.data,i=o.error,u=o.isLoading;return{configurablePrograms:null!==(t=null==l?void 0:l.data)&&void 0!==t?t:[],isLoading:u,error:i}}(e),A=y.configurablePrograms,_=y.isLoading,h=y.error;return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){s(e,t,r[t])}))}return e}({enrollments:i},o?{isLoading:_,isError:h}:{isLoading:d,isError:u}),r=null!=(r={isValidating:p,activeEnrollments:g,availablePrograms:v,eligiblePrograms:b,configurablePrograms:A})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t}},506:(e,t,r)=>{r.d(t,{Z:()=>l});const n=function(e,t,r){for(var n=-1,a=Object(e),o=r(e),l=o.length;l--;){var i=o[++n];if(!1===t(a[i],i,a))break}return e};var a=r(4753);var o=r(3282);const l=(i=function(e,t){return e&&n(e,t,a.Z)},function(e,t){if(null==e)return e;if(!(0,o.Z)(e))return i(e,t);for(var r=e.length,n=-1,a=Object(e);++n<r&&!1!==t(a[n],n,a););return e});var i},9626:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r(2300),a=r(506);const o=function(e,t){var r=[];return(0,a.Z)(e,(function(e,n,a){t(e,n,a)&&r.push(e)})),r};var l=r(4259),i=r(7885);const u=function(e,t){return((0,i.Z)(e)?n.Z:o)(e,(0,l.Z)(t,3))}},3139:(e,t,r)=>{r.d(t,{Z:()=>C});var n=r(1721),a=r(3282),o=r(8147),l=r(7885),i=r(3391);var u=/\s/;var s=/^\s+/;const c=function(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&u.test(e.charAt(t)););return t}(e)+1).replace(s,""):e};var m=r(3122),d=r(2758),p=/^[-+]0x[0-9a-f]+$/i,g=/^0b[01]+$/i,f=/^0o[0-7]+$/i,v=parseInt;const b=function(e){return e?Infinity===(e=function(e){if("number"==typeof e)return e;if((0,d.Z)(e))return NaN;if((0,m.Z)(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=(0,m.Z)(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=c(e);var r=g.test(e);return r||f.test(e)?v(e.slice(2),r?2:8):p.test(e)?NaN:+e}(e))||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};var y=r(5598);var A=r(4753);const _=function(e){return null==e?[]:function(e,t){return(0,y.Z)(t,(function(t){return e[t]}))}(e,(0,A.Z)(e))};var h=Math.max;const C=function(e,t,r,u){e=(0,a.Z)(e)?e:_(e),r=r&&!u?function(e){var t=b(e),r=t%1;return t==t?r?t-r:t:0}(r):0;var s=e.length;return r<0&&(r=h(s+r,0)),function(e){return"string"==typeof e||!(0,l.Z)(e)&&(0,i.Z)(e)&&"[object String]"==(0,o.Z)(e)}(e)?r<=s&&e.indexOf(t,r)>-1:!!s&&(0,n.Z)(e,t,r)>-1}},6772:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(5598),a=r(4259),o=r(506),l=r(3282);const i=function(e,t){var r=-1,n=(0,l.Z)(e)?Array(e.length):[];return(0,o.Z)(e,(function(e,a,o){n[++r]=t(e,a,o)})),n};var u=r(7885);const s=function(e,t){return((0,u.Z)(e)?n.Z:i)(e,(0,a.Z)(t,3))}}}]);