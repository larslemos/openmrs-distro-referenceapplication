"use strict";(globalThis.webpackChunk_openmrs_esm_patient_chart_app=globalThis.webpackChunk_openmrs_esm_patient_chart_app||[]).push([[8337],{7453:(t,e,n)=>{n.d(e,{Z:()=>s});var i=n(272),r=n.n(i),o=n(2609),a=n.n(o)()(r());a.push([t.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-chart__end-visit-dialog__bodyShort02___VnI_l{font-size:var(--cds-body-compact-02-font-size, 1rem);font-weight:var(--cds-body-compact-02-font-weight, 400);line-height:var(--cds-body-compact-02-line-height, 1.375);letter-spacing:var(--cds-body-compact-02-letter-spacing, 0);color:#161616}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/visit/visit-prompt/end-visit-dialog.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCpDF,2DCu0BI,oDAAA,CAAA,uDAAA,CAAA,yDAAA,CAAA,2DAAA,CDr0BF,aDDM",sourceRoot:""}]),a.locals={bodyShort02:"-esm-patient-chart__end-visit-dialog__bodyShort02___VnI_l"};const s=a},2609:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,r,o){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(i)for(var s=0;s<this.length;s++){var u=this[s][0];null!=u&&(a[u]=!0)}for(var c=0;c<t.length;c++){var l=[].concat(t[c]);i&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),e.push(l))}},e}},272:t=>{t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(r," */"),a=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(a).concat([o]).join("\n")}return[e].join("\n")}},3008:(t,e,n)=>{n.d(e,{Aq:()=>u,Ls:()=>p});var i=n(5047),r=n.n(i),o=n(906);function a(t,e,n,i,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,r)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){a(o,i,r,s,u,"next",t)}function u(t){a(o,i,r,s,u,"throw",t)}s(void 0)}))}}function u(t,e,n,i,r,o,a,s,u){return c.apply(this,arguments)}function c(){return(c=s(r().mark((function t(e,n,i,a,s,u,c,d,p){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([l(d,e,n,c,p)]);case 2:return t.abrupt("return",(0,o.openmrsFetch)("/ws/rest/v1/visit-queue-entry",{method:"POST",headers:{"Content-Type":"application/json"},signal:c.signal,body:{visit:{uuid:e},queueEntry:{status:{uuid:s},priority:{uuid:a},queue:{uuid:n},patient:{uuid:i},startedAt:(0,o.toDateObjectStrict)((0,o.toOmrsIsoString)(new Date)),sortWeight:u}}}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function l(t,e,n,i,r){return d.apply(this,arguments)}function d(){return(d=s(r().mark((function t(e,n,i,a,s){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,o.openmrsFetch)("/ws/rest/v1/queue-entry-number?location=".concat(e,"&queue=").concat(i,"&visit=").concat(n,"&visitAttributeType=").concat(s),{method:"GET",headers:{"Content-Type":"application/json"},signal:a.signal});case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t,e,n){return(0,o.openmrsFetch)("/ws/rest/v1/queue/".concat(t,"/entry/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:{endedAt:(0,o.toDateObjectStrict)((0,o.toOmrsIsoString)(new Date))},signal:n.signal})}},5876:(t,e,n)=>{n.d(e,{t:()=>o});var i=n(3255),r=n(906);function o(t,e){var n,o,a,s="/ws/rest/v1/visit-queue-entry?patient=".concat(t),u=(0,i.ZP)(s,r.openmrsFetch),c=u.data,l=u.error,d=u.isLoading,p=u.isValidating,f=null!==(a=null==c||null===(n=c.data)||void 0===n||null===(o=n.results)||void 0===o?void 0:o.map((function(t){var e,n,i,r;return{id:t.uuid,name:t.queueEntry.queue.display,patientUuid:t.queueEntry.patient.uuid,priority:"Urgent"===t.queueEntry.priority.display?"Priority":t.queueEntry.priority.display,priorityUuid:t.queueEntry.priority.uuid,service:null===(e=t.queueEntry.queue)||void 0===e?void 0:e.display,status:t.queueEntry.status.display,statusUuid:t.queueEntry.status.uuid,visitUuid:null===(n=t.visit)||void 0===n?void 0:n.uuid,visitType:null===(i=t.visit)||void 0===i||null===(r=i.visitType)||void 0===r?void 0:r.display,queueUuid:t.queueEntry.queue.uuid,queueEntryUuid:t.queueEntry.uuid}})).filter((function(t){return void 0!==e&&e===t.visitUuid})).shift())&&void 0!==a?a:null;return{queueEntry:f,isLoading:d,isError:l,isValidating:p}}n(268)},8337:(t,e,n)=>{n.r(e),n.d(e,{default:()=>T});var i=n(268),r=n.n(i),o=n(4924),a=n(4350),s=n(906),u=n(6839),c=n(1354),l=n.n(c),d=n(1583),p=n.n(d),f=n(7378),v=n.n(f),h=n(5993),y=n.n(h),m=n(4154),b=n.n(m),g=n(8141),A=n.n(g),w=n(7453),E={};E.styleTagTransform=A(),E.setAttributes=y(),E.insert=v().bind(null,"head"),E.domAPI=p(),E.insertStyleElement=b(),l()(w.Z,E);const _=w.Z&&w.Z.locals?w.Z.locals:void 0;var C=n(5876),q=n(3008);const T=function(t){var e=t.patientUuid,n=t.closeModal,i=(0,o.useTranslation)().t,c=(0,s.useVisit)(e),l=c.currentVisit,d=c.mutate,p=(0,C.t)(e,null==l?void 0:l.uuid).queueEntry;return r().createElement("div",null,r().createElement(a.ModalHeader,{closeModal:n,label:i("visit","Visit"),title:i("endActiveVisit","End active visit")}),r().createElement(a.ModalBody,null,r().createElement("p",{className:_.bodyShort02},i("endVisitWarningMessage","Ending this visit will not allow you to fill another encounter form for this patient"),".")),r().createElement(a.ModalFooter,null,r().createElement(a.Button,{kind:"secondary",onClick:n},i("cancel","Cancel")),r().createElement(a.Button,{kind:"danger",onClick:function(){var t={location:l.location.uuid,startDatetime:(0,s.parseDate)(l.startDatetime),visitType:l.visitType.uuid,stopDatetime:new Date},e=new AbortController;(0,s.updateVisit)(l.uuid,t,e).pipe((0,u.P)()).subscribe((function(t){var r,o;200===t.status&&(p&&(0,q.Ls)(p.queueUuid,p.queueEntryUuid,e),d(),n(),(0,s.showToast)({critical:!0,kind:"success",description:i("visitEndSuccessfully","".concat(null==t||null===(r=t.data)||void 0===r||null===(o=r.visitType)||void 0===o?void 0:o.display," ended successfully")),title:i("visitEnded","Visit ended")}))}),(function(t){(0,s.showNotification)({title:i("endVisitError","Error ending active visit"),kind:"error",critical:!0,description:null==t?void 0:t.message})}))}},i("endVisit_title","End Visit"))))}},1354:t=>{var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var o={},a=[],s=0;s<t.length;s++){var u=t[s],c=i.base?u[0]+i.base:u[0],l=o[c]||0,d="".concat(c," ").concat(l);o[c]=l+1;var p=n(d),f={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==p)e[p].references++,e[p].updater(f);else{var v=r(f,i);i.byIndex=s,e.splice(s,0,{identifier:d,updater:v,references:1})}a.push(d)}return a}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var o=i(t=t||[],r=r||{});return function(t){t=t||[];for(var a=0;a<o.length;a++){var s=n(o[a]);e[s].references--}for(var u=i(t,r),c=0;c<o.length;c++){var l=n(o[c]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}o=u}}},7378:t=>{var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},4154:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},5993:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},1583:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},8141:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},6839:(t,e,n)=>{n.d(e,{P:()=>A});var i=n(4397),r=n(2730),o=n(2995),a=n(1881),s=n(9120),u=n(4773);function c(t){return function(e){return 0===t?(0,u.c)():e.lift(new l(t))}}var l=function(){function t(t){if(this.total=t,this.total<0)throw new s.W}return t.prototype.call=function(t,e){return e.subscribe(new d(t,this.total))},t}(),d=function(t){function e(e,n){var i=t.call(this,e)||this;return i.total=n,i.count=0,i}return o.ZT(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(a.L);function p(t){return void 0===t&&(t=null),function(e){return e.lift(new f(t))}}var f=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new v(t,this.defaultValue))},t}(),v=function(t){function e(e,n){var i=t.call(this,e)||this;return i.defaultValue=n,i.isEmpty=!0,i}return o.ZT(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(a.L);function h(t){return void 0===t&&(t=b),function(e){return e.lift(new y(t))}}var y=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new m(t,this.errorFactory))},t}(),m=function(t){function e(e,n){var i=t.call(this,e)||this;return i.errorFactory=n,i.hasValue=!1,i}return o.ZT(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}(a.L);function b(){return new i.K}var g=n(6930);function A(t,e){var n=arguments.length>=2;return function(o){return o.pipe(t?(0,r.h)((function(e,n){return t(e,n,o)})):g.y,c(1),n?p(e):h((function(){return new i.K})))}}}}]);