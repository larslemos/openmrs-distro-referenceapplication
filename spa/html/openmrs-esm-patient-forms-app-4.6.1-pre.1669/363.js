"use strict";(globalThis.webpackChunk_openmrs_esm_patient_forms_app=globalThis.webpackChunk_openmrs_esm_patient_forms_app||[]).push([[363],{8360:(e,t,n)=>{n.d(t,{Z:()=>s});var r=n(272),a=n.n(r),o=n(2609),i=n.n(o)()(a());i.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}:root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-forms__offline-forms-styles__productiveHeading01___VR54s{font-size:var(--cds-heading-compact-01-font-size, 0.875rem);font-weight:var(--cds-heading-compact-01-font-weight, 600);line-height:var(--cds-heading-compact-01-line-height, 1.28572);letter-spacing:var(--cds-heading-compact-01-letter-spacing, 0.16px)}.-esm-patient-forms__offline-forms-styles__productiveHeading03___ES52X,.-esm-patient-forms__offline-forms-styles__pageHeaderContainer___ecJQd .-esm-patient-forms__offline-forms-styles__pageHeader___svGcH{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0)}.-esm-patient-forms__offline-forms-styles__productiveHeading04___du0_u{font-size:var(--cds-heading-04-font-size, 1.75rem);font-weight:var(--cds-heading-04-font-weight, 400);line-height:var(--cds-heading-04-line-height, 1.28572);letter-spacing:var(--cds-heading-04-letter-spacing, 0)}.-esm-patient-forms__offline-forms-styles__bodyLong01___i3PY8{font-size:var(--cds-body-01-font-size, 0.875rem);font-weight:var(--cds-body-01-font-weight, 400);line-height:var(--cds-body-01-line-height, 1.42857);letter-spacing:var(--cds-body-01-letter-spacing, 0.16px)}.-esm-patient-forms__offline-forms-styles__bodyShort01___S0vYz{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px)}.-esm-patient-forms__offline-forms-styles__label01___xfyMv{font-size:var(--cds-label-01-font-size, 0.75rem);font-weight:var(--cds-label-01-font-weight, 400);line-height:var(--cds-label-01-line-height, 1.33333);letter-spacing:var(--cds-label-01-letter-spacing, 0.32px)}.-esm-patient-forms__offline-forms-styles__pageHeaderContainer___ecJQd{display:flex;justify-content:space-between;align-items:center;margin:0 1rem 1rem 1rem}.-esm-patient-forms__offline-forms-styles__pageHeaderContainer___ecJQd .-esm-patient-forms__offline-forms-styles__pageHeader___svGcH{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.-esm-patient-forms__offline-forms-styles__contentContainer___lLDEj{margin:0 1rem}.-esm-patient-forms__offline-forms-styles__tableHeaderContainer___cPVP8{display:grid;grid-template-columns:1fr 50%}.-esm-patient-forms__offline-forms-styles__tableHeaderContainer___cPVP8 .-esm-patient-forms__offline-forms-styles__tableSearch___GZer3{grid-column:2;align-self:end}.omrs-breakpoint-gt-tablet .-esm-patient-forms__offline-forms-styles__tableHeaderContainer___cPVP8{grid-template-columns:1fr 250px}.omrs-breakpoint-gt-tablet .-esm-patient-forms__offline-forms-styles__tableHeaderContainer___cPVP8 .-esm-patient-forms__offline-forms-styles__tableSearch___GZer3{grid-column:3}.-esm-patient-forms__offline-forms-styles__availableOfflineToggle___w_RVf .cds--toggle__switch{margin-top:0 !important}.-esm-patient-forms__offline-forms-styles__availableOfflineToggle___w_RVf .cds--toggle__label-text{display:none}.-esm-patient-forms__offline-forms-styles__availableOfflineToggleSkeleton___hD9xS{width:2rem;height:1rem}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/root.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss","webpack://./src/offline-forms/offline-forms.styles.scss","webpack://./../../node_modules/@carbon/layout/scss/generated/_spacing.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CAHF,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCnDF,uECs0BI,2DAAA,CAAA,0DAAA,CAAA,8DAAA,CAAA,mEAAA,CDl0BJ,4MCk0BI,kDAAA,CAAA,kDAAA,CAAA,kDAAA,CAAA,sDAAA,CD9zBJ,uEC8zBI,kDAAA,CAAA,kDAAA,CAAA,sDAAA,CAAA,sDAAA,CD1zBJ,8DC0zBI,gDAAA,CAAA,+CAAA,CAAA,mDAAA,CAAA,wDAAA,CDtzBJ,+DCszBI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CDlzBJ,2DCkzBI,gDAAA,CAAA,gDAAA,CAAA,oDAAA,CAAA,yDAAA,CCr0BJ,uEACE,YAAA,CACA,6BAAA,CACA,kBAAA,CACA,uBAAA,CAEA,qIAEE,sBAAA,CACA,eAAA,CACA,kBAAA,CAIJ,oEACE,aAAA,CAGF,wEACE,YAAA,CACA,6BAAA,CAEA,uIACE,aAAA,CACA,cAAA,CAIJ,mGACE,+BAAA,CAEA,kKACE,aAAA,CAKF,+FAKE,uBAAA,CAGF,mGACE,YAAA,CAIJ,kFACE,UCfW,CDgBX,WC1BW",sourceRoot:""}]),i.locals={productiveHeading01:"-esm-patient-forms__offline-forms-styles__productiveHeading01___VR54s",productiveHeading03:"-esm-patient-forms__offline-forms-styles__productiveHeading03___ES52X",pageHeaderContainer:"-esm-patient-forms__offline-forms-styles__pageHeaderContainer___ecJQd",pageHeader:"-esm-patient-forms__offline-forms-styles__pageHeader___svGcH",productiveHeading04:"-esm-patient-forms__offline-forms-styles__productiveHeading04___du0_u",bodyLong01:"-esm-patient-forms__offline-forms-styles__bodyLong01___i3PY8",bodyShort01:"-esm-patient-forms__offline-forms-styles__bodyShort01___S0vYz",label01:"-esm-patient-forms__offline-forms-styles__label01___xfyMv",contentContainer:"-esm-patient-forms__offline-forms-styles__contentContainer___lLDEj",tableHeaderContainer:"-esm-patient-forms__offline-forms-styles__tableHeaderContainer___cPVP8",tableSearch:"-esm-patient-forms__offline-forms-styles__tableSearch___GZer3",availableOfflineToggle:"-esm-patient-forms__offline-forms-styles__availableOfflineToggle___w_RVf",availableOfflineToggleSkeleton:"-esm-patient-forms__offline-forms-styles__availableOfflineToggleSkeleton___hD9xS"};const s=i},9871:(e,t,n)=>{n.d(t,{MS:()=>A,cq:()=>d});var r=n(5047),a=n.n(r),o=n(3565),i=n.n(o),s=n(3255),l=n(906),f=n(3871),c=n(5543);function m(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){m(o,r,a,i,s,"next",e)}function s(e){m(o,r,a,i,s,"throw",e)}i(void 0)}))}}function d(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=(0,l.useConfig)(),r=n.showConfigurableForms,o=n.customFormsUrl,i=n.showHtmlFormEntryForms,c=r?o.concat("?patientUuid=".concat(t)):i?f.lA:f.HW;return(0,s.ZP)([c,e],u(a().mark((function t(){var n,o,i,s,f,m;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,(0,l.openmrsFetch)(c);case 3:if(i=t.sent,f=r?null==i?void 0:i.data.results:null!==(s=null===(n=i.data)||void 0===n||null===(o=n.results)||void 0===o?void 0:o.filter((function(e){return e.published&&!/component/i.test(e.name)})))&&void 0!==s?s:[],e){t.next=8;break}return t.abrupt("return",f);case 8:return t.next=10,(0,l.getDynamicOfflineDataEntries)("form");case 10:return m=t.sent,t.abrupt("return",f.filter((function(e){return m.some((function(t){return t.identifier===e.uuid}))})));case 12:case"end":return t.stop()}}),t)}))))}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i()(new Date).startOf("day").subtract(500,"day").toDate(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i()(new Date).endOf("day").toDate(),r="/ws/rest/v1/encounter?v=".concat(f._V,"&patient=").concat(e,"&fromdate=").concat(t.toISOString(),"&todate=").concat(n.toISOString());return(0,s.ZP)(r,(function(e){return(0,l.openmrsFetch)(e)}))}function A(e,t,n){var r,a,o,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(0,l.useConfig)().htmlFormEntryForms,f=d(i,e),m=_(e,t,n),u=null!==(o=null===(r=m.data)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.results)&&void 0!==o?o:[],A=f.data?p(f.data,u):void 0,g=(0,l.useSession)(),v=function(){f.mutate(),m.mutate()},h=i?null==A?void 0:A.filter((function(e){return(0,c.LD)(e.form,s)})):A;return(null==g?void 0:g.user)&&(h=null==h?void 0:h.filter((function(e){var t,n,r;return(0,l.userHasAccess)(null==e||null===(t=e.form)||void 0===t||null===(n=t.encounterType)||void 0===n||null===(r=n.editPrivilege)||void 0===r?void 0:r.display,g.user)}))),{data:h,error:f.error,isValidating:f.isValidating||m.isValidating,allForms:f.data,mutateForms:v}}function p(e,t){return e.map((function(e){var n=t.filter((function(t){var n;return(null===(n=t.form)||void 0===n?void 0:n.uuid)===(null==e?void 0:e.uuid)})).sort((function(e,t){var n,r;return(null===(n=e.form)||void 0===n?void 0:n.display)>(null===(r=t.form)||void 0===r?void 0:r.display)?1:-1})),r=n.length>0?new Date(null==n?void 0:n[0].encounterDatetime):void 0;return{form:e,associatedEncounters:n,lastCompleted:r}}))}},5543:(e,t,n)=>{n.d(t,{LD:()=>o,nY:()=>s});var r=n(3255),a=n(906);function o(e,t){var n=t.some((function(t){return t.formUuid===e.uuid})),r=e.resources.some(i);return!n&&r}function i(e){return"AmpathJsonSchema"===e.dataType||"JSON schema"===e.name}function s(){return(0,r.ZP)("dynamicFormEntries",(function(){return(0,a.getDynamicOfflineDataEntries)("form")}))}},4363:(e,t,n)=>{n.r(t),n.d(t,{default:()=>B});var r=n(5047),a=n.n(r),o=n(268),i=n.n(o),s=n(4924),l=n(9377),f=n(906),c=n(5543),m=n(9871);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(){var e,t,n,r=(0,m.cq)(),a=(0,f.useConfig)();return t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}({},r),n=null!=(n={data:null===(e=r.data)||void 0===e?void 0:e.filter((function(e){return(0,c.LD)(e,a.htmlFormEntryForms)}))})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t}var _=n(1354),A=n.n(_),p=n(1583),g=n.n(p),v=n(7378),h=n.n(v),y=n(3927),b=n.n(y),C=n(4154),w=n.n(C),D=n(8141),E=n.n(D),O=n(8360),S={};S.styleTagTransform=E(),S.setAttributes=b(),S.insert=h().bind(null,"head"),S.domAPI=g(),S.insertStyleElement=w(),A()(O.Z,S);const P=O.Z&&O.Z.locals?O.Z.locals:void 0;var H=n(6217);function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function T(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function F(){return F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},F.apply(this,arguments)}function x(e){var t,n,r,m,u,d=e.form,_=e.disabled,A=(0,s.useTranslation)().t,p=(m=(0,o.useState)(!1),u=2,function(e){if(Array.isArray(e))return e}(m)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(m,u)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}(m,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),g=p[0],v=p[1],h=(0,c.nY)(),y=null===(t=h.data)||void 0===t?void 0:t.some((function(e){return e.identifier===d.uuid})),b=(n=a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v(!0),e.prev=1,!t){e.next=9;break}return e.next=5,(0,f.putDynamicOfflineData)("form",d.uuid);case 5:return e.next=7,(0,f.syncDynamicOfflineData)("form",d.uuid);case 7:e.next=11;break;case 9:return e.next=11,(0,f.removeDynamicOfflineData)("form",d.uuid);case 11:return e.prev=11,v(!1),h.mutate(),e.finish(11);case 15:case"end":return e.stop()}}),e,null,[[1,,11,15]])})),r=function(){var e=this,t=arguments;return new Promise((function(r,a){var o=n.apply(e,t);function i(e){T(o,r,a,i,s,"next",e)}function s(e){T(o,r,a,i,s,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)});return h.isValidating?i().createElement(l.uKo,{className:P.availableOfflineToggleSkeleton}):i().createElement("div",null,i().createElement(l.ZDl,{"aria-label":A("offlineToggle","Offline toggle"),id:"".concat(d.uuid,"-offline-toggle"),className:P.availableOfflineToggle,labelA:"",labelB:"",labelText:"",size:"sm",toggled:y,disabled:_||g||h.isValidating,onToggle:b}))}const B=function(e){var t,n,r,a,o=e.canMarkFormsAsOffline,c=(0,s.useTranslation)().t,m=(0,f.useSession)(),u=d(),_=(0,f.useLayoutType)(),A=(0,f.isDesktop)(_)?"sm":void 0,p=[{key:"formName",header:c("offlineFormsTableFormNameHeader","Form name")},{key:"availableOffline",header:c("offlineFormsTableFormAvailableOffline","Offline")}],g=null!==(r=null===(t=u.data)||void 0===t?void 0:t.filter((function(e){var t,n;return(0,f.userHasAccess)(null==e||null===(t=e.encounterType)||void 0===t||null===(n=t.editPrivilege)||void 0===n?void 0:n.display,null==m?void 0:m.user)})).map((function(e){return{id:e.uuid,formName:e.name,availableOffline:i().createElement(x,{form:e,disabled:!o})}})))&&void 0!==r?r:[];return 0===(null==u||null===(n=u.data)||void 0===n?void 0:n.length)?i().createElement("div",{className:P.contentContainer},i().createElement(H.EmptyState,{displayText:c("offlineForms__lower","offline forms"),headerTitle:c("offlineForms","Offline forms")})):i().createElement(i().Fragment,null,i().createElement("header",{className:P.pageHeaderContainer},i().createElement("h1",{className:P.pageHeader},c("offlineFormsTitle","Offline forms"))),i().createElement("main",{className:P.contentContainer},i().createElement(l.wQF,{rows:g,headers:p,size:"sm",useZebraStyles:!0},(function(e){var t=e.rows,n=e.headers,r=e.getTableProps,o=e.getHeaderProps,s=e.getRowProps,f=e.getTableContainerProps,m=e.onInputChange;return i().createElement(l.xJi,F({},f()),i().createElement("div",{className:P.tableHeaderContainer},i().createElement(l.olm,{className:P.tableSearch,labelText:c("offlinePatientsTableSearchLabel","Search this list"),placeholder:c("offlinePatientsTableSearchPlaceholder","Search this list"),size:A,onChange:m,light:!0})),i().createElement(l.iA_,F({},r(),{isSortable:!0,useZebraStyles:!0}),i().createElement(l.ssF,null,i().createElement(l.SCH,null,n.map((function(e){return i().createElement(l.xDH,F({},o({header:e}),{isSortable:!0}),e.header)})))),i().createElement(l.RMI,null,t.map((function(e){return i().createElement(l.SCH,F({},s({row:e})),e.cells.map((function(e){var t;return i().createElement(l.pj1,{key:e.id},null!==(a=null===(t=e.value)||void 0===t?void 0:t.value)&&void 0!==a?a:e.value)})))})))))}))))}}}]);